<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Carrito - Pastas Nonna</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#f5f6f7;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    .flag{height:8px;background:linear-gradient(90deg,#009246 33%,#fff 33% 66%,#ce2b37 66%)}
    .hero{background:#fff;border:1px solid #e5e5e5;border-radius:10px}
    .thumb{width:64px;aspect-ratio:1/1;object-fit:cover;border-radius:8px;border:1px solid #eee}
    #toastArea{position:fixed;top:16px;right:16px;z-index:1080}
    @media (max-width:576px){#toastArea{left:16px;right:16px}}
  </style>
</head>
<body>
  <div class="flag"></div>

  <div class="container py-3">
    <div class="hero p-3 mb-3 d-flex justify-content-between align-items-center">
      <strong class="fs-5">üõí Tu Carrito</strong>
      <a href="catalogo.html" class="btn btn-outline-secondary btn-sm">‚Üê Seguir comprando</a>
    </div>

    <div id="lista" class="mb-3"></div>

    <div class="hero p-3 d-flex flex-column flex-md-row gap-2 justify-content-between align-items-center">
      <div class="fw-semibold">Total: $<span id="total">0</span></div>
      <div class="d-flex gap-2 w-100 w-md-auto">
        <button id="vaciar" class="btn btn-outline-danger flex-fill">Vaciar carrito</button>
        <button id="comprar" class="btn btn-success flex-fill">Comprar</button>
      </div>
    </div>
  </div>

  <div class="flag"></div>

  <div id="toastArea"></div>

  <script>
    const LS_KEY="carrito";
    const getCart = ()=> JSON.parse(localStorage.getItem(LS_KEY)||"[]");
    const setCart = (c)=> localStorage.setItem(LS_KEY, JSON.stringify(c));

    const lista = document.getElementById('lista');
    const totalEl = document.getElementById('total');

    function render(){
      const cart = getCart();
      lista.innerHTML = "";
      let total = 0;

      if(cart.length===0){
        lista.innerHTML = `<div class="hero p-5 text-center text-muted">Tu carrito est√° vac√≠o.</div>`;
        totalEl.textContent = "0";
        return;
      }

      cart.forEach((p,idx)=>{
        total += p.precio * p.cantidad;
        const row = document.createElement('div');
        row.className = "hero p-3 mb-2";
        row.innerHTML = `
          <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
            <div class="d-flex align-items-center gap-3">
              <img src="${p.img}" class="thumb" alt="${p.nombre}">
              <div>
                <div class="fw-semibold">${p.nombre}</div>
                <small class="text-muted">$${p.precio.toLocaleString()}</small>
              </div>
            </div>
            <div class="d-flex align-items-center gap-2">
              <button class="btn btn-outline-danger btn-sm" data-act="minus" data-i="${idx}">‚àí</button>
              <div class="border px-3 py-2 rounded">${p.cantidad}</div>
              <button class="btn btn-outline-success btn-sm" data-act="plus" data-i="${idx}">+</button>
              <button class="btn btn-outline-secondary btn-sm" data-act="del" data-i="${idx}">Quitar</button>
            </div>
          </div>`;
        lista.appendChild(row);
      });

      totalEl.textContent = total.toLocaleString();
    }

    lista.addEventListener('click', (e)=>{
      const i = e.target.getAttribute('data-i');
      const act = e.target.getAttribute('data-act');
      if(i===null) return;
      let cart = getCart();
      if(act==="plus"){ cart[i].cantidad++; showToast("Cantidad actualizada","primary"); }
      if(act==="minus"){
        cart[i].cantidad--;
        if(cart[i].cantidad<=0){ showToast("Producto eliminado","warning"); cart.splice(i,1); }
        else showToast("Cantidad actualizada","primary");
      }
      if(act==="del"){ cart.splice(i,1); showToast("Producto eliminado","warning"); }
      setCart(cart); render();
    });

    document.getElementById('vaciar').onclick = ()=>{
      localStorage.removeItem(LS_KEY);
      showToast("Carrito vaciado","danger");
      render();
    };

    document.getElementById('comprar').onclick = ()=>{
      if(getCart().length===0){ showToast("Tu carrito est√° vac√≠o","danger"); return; }
      showToast("Compra simulada con √©xito","success");
      localStorage.removeItem(LS_KEY);
      render();
    };

    function showToast(msg, variant="primary"){
      const wrap = document.getElementById('toastArea');
      const el = document.createElement('div');
      el.className = `toast align-items-center text-bg-${variant} border-0 show mb-2`;
      el.innerHTML = `<div class="d-flex"><div class="toast-body">${msg}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`;
      wrap.appendChild(el);
      setTimeout(()=>el.remove(),2500);
    }

    render();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
